<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Work Like Hell</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel to transpile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Chart.js for Analytics Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* Custom font and smooth scrolling */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        html {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }
        body {
            background-color: #111827; /* bg-gray-900 */
        }
        /* Hide number input arrows */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
          -webkit-appearance: none; 
          margin: 0; 
        }
        input[type=number] {
          -moz-appearance: textfield;
        }
        .modal-backdrop {
            animation: fadeIn 0.2s ease-out forwards;
        }
        .modal-content {
            animation: slideUp 0.3s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Firebase SDKs (using ES modules) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            onAuthStateChanged, 
            signOut
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            query, 
            where, 
            onSnapshot,
            Timestamp
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Make Firebase services available globally for the React script
        window.firebase = {
            initializeApp,
            getAuth,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            onAuthStateChanged,
            signOut,
            getFirestore,
            collection,
            addDoc,
            query,
            where,
            onSnapshot,
            Timestamp
        };
    </script>

    <!-- React Application Code -->
    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- Firebase Configuration (Your details are included) ---
        // hidden, You can paste yours, firebaseconfig object

        // --- Initialize Firebase ---
        let app, auth, db;
        let firebaseInitializationError = null;
        try {
            app = window.firebase.initializeApp(firebaseConfig);
            auth = window.firebase.getAuth(app);
            db = window.firebase.getFirestore(app);
        } catch (e) {
            console.error("Firebase initialization error:", e);
            firebaseInitializationError = e.message;
        }
        
        // --- Helper Functions ---
        const convertTo24Hour = (hour, minute, period, date = new Date()) => {
            let h = parseInt(hour, 10);
            const m = parseInt(minute, 10);
            if (period.toUpperCase() === 'PM' && h < 12) h += 12;
            if (period.toUpperCase() === 'AM' && h === 12) h = 0;
            const newDate = new Date(date);
            newDate.setHours(h, m, 0, 0);
            return newDate;
        };

        const calculateHoursDecimal = (start, end) => {
            if (end < start) end.setDate(end.getDate() + 1);
            const diffMs = end - start;
            return diffMs / (1000 * 60 * 60);
        };

        const formatHoursMinutes = (decimalHours) => {
            if (isNaN(decimalHours) || decimalHours < 0) return "0 mins";
            const hours = Math.floor(decimalHours);
            const minutes = Math.round((decimalHours - hours) * 60);
            let result = '';
            if (hours > 0) result += `${hours} hour${hours > 1 ? 's' : ''} `;
            if (minutes > 0) result += `${minutes} min${minutes > 1 ? 's' : ''}`;
            return result.trim() || "0 mins";
        };

        // --- Components ---

        const Modal = ({ title, children, onConfirm, onCancel }) => {
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
                    <div className="fixed inset-0 bg-black/70 modal-backdrop" onClick={onCancel}></div>
                    <div className="bg-gray-800 rounded-2xl shadow-lg p-6 w-full max-w-sm z-10 modal-content">
                        <h3 className="text-xl font-bold text-white mb-4">{title}</h3>
                        <div className="text-gray-300 mb-6">{children}</div>
                        <div className="flex justify-end gap-3">
                            <button onClick={onCancel} className="px-4 py-2 rounded-lg bg-gray-600 hover:bg-gray-500 text-white font-semibold transition">Cancel</button>
                            <button onClick={onConfirm} className="px-4 py-2 rounded-lg bg-red-600 hover:bg-red-700 text-white font-semibold transition">Yes, Add Anyway</button>
                        </div>
                    </div>
                </div>
            );
        };

        const Login = () => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [isLogin, setIsLogin] = useState(true);
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);
                if (!email || !password) {
                    setError("Please enter both email and password.");
                    setLoading(false);
                    return;
                }
                try {
                    if (isLogin) {
                        await window.firebase.signInWithEmailAndPassword(auth, email, password);
                    } else {
                        await window.firebase.createUserWithEmailAndPassword(auth, email, password);
                    }
                } catch (err) {
                    setError(err.message.replace('Firebase: ', ''));
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="min-h-screen bg-gray-900 text-white flex items-center justify-center p-4">
                    <div className="w-full max-w-md bg-gray-800 rounded-2xl shadow-lg p-8">
                        <h1 className="text-4xl font-bold text-center mb-2 text-red-500">Work Like Hell</h1>
                        <p className="text-center text-gray-400 mb-8">{isLogin ? 'Log in to continue' : 'Create an account to start'}</p>
                        <form onSubmit={handleSubmit}>
                            {error && <p className="bg-red-500/20 text-red-400 p-3 rounded-lg mb-4 text-center">{error}</p>}
                            <div className="mb-4">
                                <label className="block text-gray-400 mb-2" htmlFor="email">Email</label>
                                <input type="email" id="email" value={email} onChange={(e) => setEmail(e.target.value)} className="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="you@example.com" />
                            </div>
                            <div className="mb-6">
                                <label className="block text-gray-400 mb-2" htmlFor="password">Password</label>
                                <input type="password" id="password" value={password} onChange={(e) => setPassword(e.target.value)} className="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="••••••••" />
                            </div>
                            <button type="submit" disabled={loading} className="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 disabled:bg-red-800 disabled:cursor-not-allowed">
                                {loading ? 'Processing...' : (isLogin ? 'Log In' : 'Sign Up')}
                            </button>
                        </form>
                        <p className="text-center text-gray-400 mt-6">
                            {isLogin ? "Don't have an account?" : "Already have an account?"}
                            <button onClick={() => setIsLogin(!isLogin)} className="text-red-500 hover:text-red-400 font-semibold ml-2 focus:outline-none">
                                {isLogin ? 'Sign Up' : 'Log In'}
                            </button>
                        </p>
                    </div>
                </div>
            );
        };
        
        const TimeInput = ({ hour, setHour, minute, setMinute, period, setPeriod, label, autoFocusHour }) => {
            const minuteRef = useRef(null);

            const handleHourChange = (e) => {
                let val = e.target.value.replace(/[^0-9]/g, '');
                if (val.length > 2) val = val.slice(0, 2);
                if (parseInt(val, 10) > 12) val = '12';
                setHour(val);
                if (val.length === 2 && val !== '00') {
                    minuteRef.current.focus();
                }
            };
            
            const handleMinuteChange = (e) => {
                let val = e.target.value.replace(/[^0-9]/g, '');
                if (val.length > 2) val = val.slice(0, 2);
                if (parseInt(val, 10) > 59) val = '59';
                setMinute(val);
            };

            return (
                <div>
                    <label className="block text-gray-400 mb-2">{label}</label>
                    <div className="flex items-center gap-2">
                        <input
                            type="text"
                            inputMode="numeric"
                            pattern="[0-9]*"
                            value={hour}
                            onChange={handleHourChange}
                            onFocus={e => e.target.select()}
                            className="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-3 text-white text-center text-lg focus:outline-none focus:ring-2 focus:ring-red-500"
                            placeholder="HH"
                            autoFocus={autoFocusHour}
                        />
                        <span className="text-gray-400 font-bold text-lg">:</span>
                        <input
                            ref={minuteRef}
                            type="text"
                            inputMode="numeric"
                            pattern="[0-9]*"
                            value={minute}
                            onChange={handleMinuteChange}
                            onFocus={e => e.target.select()}
                            className="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-3 text-white text-center text-lg focus:outline-none focus:ring-2 focus:ring-red-500"
                            placeholder="MM"
                        />
                        <select value={period} onChange={(e) => setPeriod(e.target.value)} className="bg-gray-700 border border-gray-600 rounded-lg px-3 py-3 text-white focus:outline-none focus:ring-2 focus:ring-red-500 h-[50px]">
                            <option>AM</option><option>PM</option>
                        </select>
                    </div>
                </div>
            )
        }

        const Home = ({ user }) => {
            const [startHour, setStartHour] = useState('09');
            const [startMinute, setStartMinute] = useState('30');
            const [startPeriod, setStartPeriod] = useState('AM');
            const [endHour, setEndHour] = useState('10');
            const [endMinute, setEndMinute] = useState('30');
            const [endPeriod, setEndPeriod] = useState('AM');
            
            const [date, setDate] = useState(new Date().toISOString().split('T')[0]);
            const [entries, setEntries] = useState([]);
            const [error, setError] = useState('');
            const [showOverlapModal, setShowOverlapModal] = useState(false);
            const [pendingEntry, setPendingEntry] = useState(null);

            useEffect(() => {
                const entriesCollectionRef = window.firebase.collection(db, 'users', user.uid, 'workEntries');
                const q = window.firebase.query(entriesCollectionRef);

                const unsubscribe = window.firebase.onSnapshot(q, (querySnapshot) => {
                    const fetchedEntries = [];
                    querySnapshot.forEach((doc) => fetchedEntries.push({ id: doc.id, ...doc.data() }));
                    fetchedEntries.sort((a, b) => a.startTime.seconds - b.startTime.seconds);
                    setEntries(fetchedEntries);
                }, (err) => {
                    console.error("Error fetching entries: ", err);
                    setError("Could not load entries.");
                });

                return () => unsubscribe();
            }, [user.uid]);

            const todaysEntries = useMemo(() => {
                 const selectedDate = new Date(date + 'T00:00:00');
                 const startOfDay = selectedDate.getTime();
                 const endOfDay = startOfDay + 24 * 60 * 60 * 1000;
                 return entries.filter(entry => {
                    const entryTime = entry.startTime.seconds * 1000;
                    return entryTime >= startOfDay && entryTime < endOfDay;
                 });
            }, [entries, date]);

            const addEntryToFirestore = (entryData) => {
                const entriesCollectionRef = window.firebase.collection(db, 'users', user.uid, 'workEntries');
                window.firebase.addDoc(entriesCollectionRef, entryData)
                    .catch(err => {
                        console.error("Error adding document: ", err);
                        setError('Failed to save. Please try again.');
                    });
            };
            
            const handleSubmit = (e) => {
                e.preventDefault();
                setError('');

                if (!startHour || !startMinute || !endHour || !endMinute) {
                    setError("Please fill in all time fields."); return;
                }
                
                const entryDate = new Date(date + 'T00:00:00');
                const startDateTime = convertTo24Hour(startHour, startMinute, startPeriod, entryDate);
                const endDateTime = convertTo24Hour(endHour, endMinute, endPeriod, entryDate);
                
                if (!startDateTime || !endDateTime || endDateTime <= startDateTime) {
                    setError("End time must be after start time."); return;
                }
                
                const newEntryStart = startDateTime.getTime();
                const newEntryEnd = endDateTime.getTime();

                const isOverlapping = todaysEntries.some(entry => {
                    const existingStart = entry.startTime.seconds * 1000;
                    const existingEnd = entry.endTime.seconds * 1000;
                    return (newEntryStart < existingEnd) && (newEntryEnd > existingStart);
                });

                const hoursWorked = calculateHoursDecimal(startDateTime, endDateTime);
                const newEntryData = {
                    date: window.firebase.Timestamp.fromDate(entryDate),
                    startTime: window.firebase.Timestamp.fromDate(startDateTime),
                    endTime: window.firebase.Timestamp.fromDate(endDateTime),
                    hours: hoursWorked,
                };

                if (isOverlapping) {
                    setPendingEntry(newEntryData);
                    setShowOverlapModal(true);
                } else {
                    addEntryToFirestore(newEntryData);
                }

                // Optimistic UI update for instant feedback
                setStartHour(endHour);
                setStartMinute(endMinute);
                setStartPeriod(endPeriod);
                setEndHour('');
                setEndMinute('');
            };

            const handleConfirmOverlap = () => {
                addEntryToFirestore(pendingEntry);
                setShowOverlapModal(false);
                setPendingEntry(null);
            };

            const totalHoursToday = useMemo(() => {
                return todaysEntries.reduce((total, entry) => total + entry.hours, 0);
            }, [todaysEntries]);

            return (
                <div className="p-4 sm:p-6 md:p-8">
                    {showOverlapModal && (
                        <Modal 
                            title="Time Overlap Warning"
                            onConfirm={handleConfirmOverlap}
                            onCancel={() => setShowOverlapModal(false)}
                        >
                            This entry overlaps with an existing time block. Are you sure you want to double-count this time?
                        </Modal>
                    )}
                    <h2 className="text-3xl font-bold text-white mb-6">Log Your Work Hours</h2>
                    <form onSubmit={handleSubmit} className="bg-gray-800 p-6 rounded-2xl shadow-lg mb-8">
                        {error && <p className="bg-red-500/20 text-red-400 p-3 rounded-lg mb-4 text-center">{error}</p>}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                             <div className="md:col-span-3">
                                <label className="block text-gray-400 mb-2" htmlFor="date">Date</label>
                                <input type="date" id="date" value={date} onChange={(e) => setDate(e.target.value)} className="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-red-500" />
                            </div>
                            
                            <TimeInput 
                                hour={startHour} setHour={setStartHour}
                                minute={startMinute} setMinute={setStartMinute}
                                period={startPeriod} setPeriod={setStartPeriod}
                                label="Start Time"
                                autoFocusHour={true}
                            />
                             <TimeInput 
                                hour={endHour} setHour={setEndHour}
                                minute={endMinute} setMinute={setEndMinute}
                                period={endPeriod} setPeriod={setEndPeriod}
                                label="End Time"
                            />

                            <div className="flex items-end">
                                <button type="submit" className="w-full h-[50px] bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300">
                                    Add Work Entry
                                </button>
                            </div>
                        </div>
                    </form>
                    <div className="bg-gray-800 p-6 rounded-2xl shadow-lg">
                        <h3 className="text-2xl font-bold text-white mb-4">Today's Entries</h3>
                        <div className="mb-4 text-center">
                            <p className="text-gray-400 text-lg">Total Hours Today</p>
                            <p className="text-red-500 text-5xl font-bold">{formatHoursMinutes(totalHoursToday)}</p>
                        </div>
                        <div className="space-y-3 max-h-60 overflow-y-auto pr-2">
                            {todaysEntries.length > 0 ? todaysEntries.map(entry => (
                                <div key={entry.id} className="bg-gray-700 p-4 rounded-lg flex justify-between items-center">
                                    <div>
                                        <p className="text-white font-semibold">
                                            {new Date(entry.startTime.seconds * 1000).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                                            {' - '}
                                            {new Date(entry.endTime.seconds * 1000).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                                        </p>
                                    </div>
                                    <p className="text-red-400 font-bold text-lg">{formatHoursMinutes(entry.hours)}</p>
                                </div>
                            )) : <p className="text-gray-500 text-center py-4">No work entries for today yet.</p>}
                        </div>
                    </div>
                </div>
            );
        };

        const Analytics = ({ user }) => {
            const [entries, setEntries] = useState([]);
            const [timeframe, setTimeframe] = useState('weekly');
            const [loading, setLoading] = useState(true);
            const chartRef = useRef(null);
            const chartInstanceRef = useRef(null);

            useEffect(() => {
                const entriesCollectionRef = window.firebase.collection(db, 'users', user.uid, 'workEntries');
                const unsubscribe = window.firebase.onSnapshot(entriesCollectionRef, (snapshot) => {
                    const fetchedEntries = snapshot.docs.map(doc => ({
                        id: doc.id, ...doc.data(), date: doc.data().date.toDate()
                    }));
                    fetchedEntries.sort((a, b) => a.date - b.date);
                    setEntries(fetchedEntries);
                    setLoading(false);
                }, (err) => {
                    console.error("Error fetching analytics: ", err);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, [user.uid]);

            const processedData = useMemo(() => {
                if (entries.length === 0) return { chartData: { labels: [], data: [] }, stats: {}, feedback: '' };

                const now = new Date();
                let filteredEntries = [];
                let startDate = new Date();
                
                if (timeframe === 'today') {
                    const todayEntries = entries.filter(e => e.date.toDateString() === now.toDateString());
                    const labels = todayEntries.map(e => `${new Date(e.startTime.seconds * 1000).toLocaleTimeString([], { hour: 'numeric', minute: '2-digit'})}`);
                    const data = todayEntries.map(e => parseFloat(e.hours.toFixed(2)));
                    const totalHours = data.reduce((sum, h) => sum + h, 0);
                    return {
                        chartData: { labels, data },
                        stats: { total: totalHours, average: totalHours, days: 1, entries: todayEntries.length },
                        feedback: "Here is a breakdown of your work entries for today."
                    }
                }

                switch (timeframe) {
                    case 'daily': // Show last 7 days for context
                        startDate.setDate(now.getDate() - 6);
                        break;
                    case 'weekly':
                        startDate.setDate(now.getDate() - now.getDay());
                        break;
                    case 'monthly':
                        startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                        break;
                }
                startDate.setHours(0, 0, 0, 0);
                filteredEntries = entries.filter(e => e.date >= startDate);

                const dailyTotals = filteredEntries.reduce((acc, entry) => {
                    const day = entry.date.toISOString().split('T')[0];
                    acc[day] = (acc[day] || 0) + entry.hours;
                    return acc;
                }, {});

                const sortedDays = Object.keys(dailyTotals).sort();
                const labels = sortedDays.map(day => new Date(day+'T00:00:00').toLocaleString('en-US', { month: 'short', day: 'numeric'}));
                const data = sortedDays.map(day => parseFloat(dailyTotals[day].toFixed(2)));

                const totalHours = data.reduce((sum, h) => sum + h, 0);
                const avgHours = data.length > 0 ? totalHours / data.length : 0;

                let feedback = "Keep logging your hours to see your progress!";
                if (data.length >= 2) {
                    const last = data[data.length - 1];
                    const secondLast = data[data.length - 2];
                    if (last > secondLast) {
                        const improvement = secondLast > 0 ? ((last - secondLast) / secondLast) * 100 : 100;
                        feedback = `Excellent work! You improved by ${improvement.toFixed(0)}%. Keep that momentum going! 🔥`;
                    } else if (last < secondLast) {
                        feedback = "A slight dip, but consistency is key. You've got this! 💪";
                    } else {
                        feedback = "Solid and steady performance. Keep up the great work!";
                    }
                } else if (data.length === 1) {
                    feedback = `Great start for this period with ${formatHoursMinutes(data[0])}!`;
                }

                return {
                    chartData: { labels, data },
                    stats: { total: totalHours, average: avgHours, days: data.length, entries: filteredEntries.length },
                    feedback
                };
            }, [entries, timeframe]);

            useEffect(() => {
                if (chartRef.current && processedData.chartData) {
                    if (chartInstanceRef.current) {
                        chartInstanceRef.current.destroy();
                    }
                    const ctx = chartRef.current.getContext('2d');
                    chartInstanceRef.current = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: processedData.chartData.labels,
                            datasets: [{
                                label: 'Hours Worked',
                                data: processedData.chartData.data,
                                backgroundColor: 'rgba(229, 62, 62, 0.7)',
                                borderColor: 'rgba(229, 62, 62, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: { beginAtZero: true, ticks: { color: '#A0AEC0' }, grid: { color: '#4A5568' } },
                                x: { ticks: { color: '#A0AEC0' }, grid: { color: '#2D3748' } }
                            },
                            plugins: { legend: { labels: { color: '#A0AEC0' } } }
                        }
                    });
                }
            }, [processedData]);

            if (loading) return <div className="text-center p-10 text-white">Loading Analytics...</div>;

            return (
                <div className="p-4 sm:p-6 md:p-8">
                    <h2 className="text-3xl font-bold text-white mb-6">Performance Analytics</h2>
                    <div className="flex justify-center mb-6 bg-gray-800 rounded-full p-1 max-w-md mx-auto">
                        <button onClick={() => setTimeframe('today')} className={`w-full py-2 px-4 rounded-full text-sm font-semibold transition ${timeframe === 'today' ? 'bg-red-600 text-white' : 'text-gray-400 hover:bg-gray-700'}`}>Today</button>
                        <button onClick={() => setTimeframe('daily')} className={`w-full py-2 px-4 rounded-full text-sm font-semibold transition ${timeframe === 'daily' ? 'bg-red-600 text-white' : 'text-gray-400 hover:bg-gray-700'}`}>7 Days</button>
                        <button onClick={() => setTimeframe('weekly')} className={`w-full py-2 px-4 rounded-full text-sm font-semibold transition ${timeframe === 'weekly' ? 'bg-red-600 text-white' : 'text-gray-400 hover:bg-gray-700'}`}>Weekly</button>
                        <button onClick={() => setTimeframe('monthly')} className={`w-full py-2 px-4 rounded-full text-sm font-semibold transition ${timeframe === 'monthly' ? 'bg-red-600 text-white' : 'text-gray-400 hover:bg-gray-700'}`}>Monthly</button>
                    </div>
                    <div className="bg-gray-800 p-6 rounded-2xl shadow-lg mb-8">
                        <p className="text-center text-lg text-yellow-400 mb-6 font-semibold">{processedData.feedback}</p>
                        <div className="h-80">
                            {processedData.chartData.data.length > 0 ? <canvas ref={chartRef}></canvas> : <p className="text-center text-gray-500 pt-20">No data to display for this period.</p>}
                        </div>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                        <div className="bg-gray-800 p-6 rounded-2xl shadow-lg">
                            <h4 className="text-gray-400 text-lg font-semibold mb-2">Total Hours</h4>
                            <p className="text-red-500 text-4xl font-bold">{formatHoursMinutes(processedData.stats.total)}</p>
                        </div>
                        <div className="bg-gray-800 p-6 rounded-2xl shadow-lg">
                             <h4 className="text-gray-400 text-lg font-semibold mb-2">{timeframe === 'today' ? 'Average Entry' : 'Daily Average'}</h4>
                            <p className="text-red-500 text-4xl font-bold">{formatHoursMinutes(timeframe === 'today' ? (processedData.stats.total / processedData.stats.entries) || 0 : processedData.stats.average)}</p>
                        </div>
                        <div className="bg-gray-800 p-6 rounded-2xl shadow-lg">
                            <h4 className="text-gray-400 text-lg font-semibold mb-2">{timeframe === 'today' ? 'Total Entries' : 'Productive Days'}</h4>
                            <p className="text-red-500 text-4xl font-bold">{timeframe === 'today' ? processedData.stats.entries : processedData.stats.days}</p>
                        </div>
                    </div>
                </div>
            );
        };
        
        const App = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [activeTab, setActiveTab] = useState('home');

            useEffect(() => {
                if (firebaseInitializationError) {
                    setLoading(false);
                    return;
                }
                const unsubscribe = window.firebase.onAuthStateChanged(auth, (currentUser) => {
                    setUser(currentUser);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, []);

            if (firebaseInitializationError) {
                return (
                    <div className="min-h-screen bg-gray-900 text-white flex items-center justify-center p-4">
                        <div className="w-full max-w-lg bg-red-900 border border-red-700 rounded-2xl shadow-lg p-8 text-center">
                            <h1 className="text-2xl font-bold mb-4">Application Error</h1>
                            <p className="text-red-300">Could not initialize the database. Please check the browser console for more details.</p>
                            <pre className="text-left bg-gray-800 p-3 rounded-lg mt-4 text-sm text-red-200 overflow-x-auto">
                                {firebaseInitializationError}
                            </pre>
                        </div>
                    </div>
                );
            }

            const handleLogout = () => window.firebase.signOut(auth);

            if (loading) {
                return <div className="min-h-screen bg-gray-900 flex items-center justify-center"><p className="text-white text-xl">Loading...</p></div>;
            }

            if (!user) return <Login />;

            return (
                <div className="min-h-screen bg-gray-900 text-white">
                    <nav className="bg-gray-800/50 backdrop-blur-sm shadow-lg sticky top-0 z-10">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex items-center justify-between h-16">
                                <span className="font-bold text-xl text-red-500">Work Like Hell</span>
                                <div className="flex items-center space-x-4">
                                    <button onClick={() => setActiveTab('home')} className={`px-3 py-2 rounded-md text-sm font-medium ${activeTab === 'home' ? 'bg-red-600 text-white' : 'text-gray-300 hover:bg-gray-700'}`}>Home</button>
                                    <button onClick={() => setActiveTab('analytics')} className={`px-3 py-2 rounded-md text-sm font-medium ${activeTab === 'analytics' ? 'bg-red-600 text-white' : 'text-gray-300 hover:bg-gray-700'}`}>Analytics</button>
                                    <button onClick={handleLogout} className="bg-gray-700 hover:bg-gray-600 text-white px-3 py-2 rounded-md text-sm font-medium">Logout</button>
                                </div>
                            </div>
                        </div>
                    </nav>
                    <main className="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
                        <div style={{ display: activeTab === 'home' ? 'block' : 'none' }}>
                            <Home user={user} />
                        </div>
                        {activeTab === 'analytics' && <Analytics user={user} />}
                    </main>
                </div>
            );
        };
        
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);

    </script>
</body>
</html>
